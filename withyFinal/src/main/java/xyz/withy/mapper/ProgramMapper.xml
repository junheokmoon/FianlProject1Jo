<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="xyz.withy.mapper.ProgramMapper">
<insert id="insertProgram">
		<selectKey resultType="int" keyProperty="programNo" order="BEFORE">
			select program_no_seq.nextval from program
		</selectKey>
		insert into program values(#{programNo}, #{programOttNo},
			,#{programName}, #{programImage},#{programDtail}, #{programVideo}, #{programCategoryNo})
	</insert> 
	
	<update id="updateProgram">
		update program set program_ott_no=#{programOttNo} ,program_name=#{programName}
			,program_image=#{programImage},program_detail=#{programDtail} ,program_video=#{programVideo}
				, program_category_no=#{programCategoryNo} where program_no=#{programNo}
	</update>
	
	<delete id="deleteProgram">
		delete from program where program_no=#{programNo}
	</delete>

	<select id="selectProgramByNo" resultType="ProgramDTO">
		select program_no, program_ott_no, program_name ,program_image ,program_detail 
			,program_video ,program_category_no from program where program_no=#{programNo}
	</select>

	<select id="selectProgramCount" resultType="int">
		select count(*) from program
	</select>

	<select id="selectProgramList" resultType="ProgramDTO">
		select * from (select rownum rn, program.* from (select program_ott_no
			,program_name ,program_image ,program_detail ,program_video ,program_category_no
			from program order by program_no desc) program) where rn between #{startRow} and #{endRow}
	</select>
	
	<select id="selectProgramJoinList" resultType="ProgramDTO">
		select program_no, program_ott_no, program_name, program_image, program_detail
			,program_video, program_category_no from program join ottkind on program_ott_no = ott_no order by program_no desc
	</select>
	
	
	<select id="selectProgramFilterByOtt" resultType="ProgramDTO">
    SELECT * FROM program
    <where>
        <if test="programOttNo != null">
            AND program_ott_no = #{programOttNo}
        </if>
        <if test="programCategoryNo != null">
            AND program_category_no = #{programCategoryNo}
        </if>
    </where>
    ORDER BY program_no DESC
</select>

	
	
	
</mapper>